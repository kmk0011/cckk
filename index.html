<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê°€ìƒ ìë™ì°¨ ì„¤ê³„ & ë¯¸ë‹ˆ ê²Œì„ ì‹œë®¬ë ˆì´í„°</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f4f4;
    }
    .page {
      display: none;
      padding: 20px;
      text-align: center;
    }
    .active {
      display: block;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    .car-preview {
      margin: 20px auto;
      width: 200px;
      height: 100px;
      position: relative;
      background-color: gray;
      border-radius: 10px;
      overflow: hidden;
    }
    .tire {
      width: 40px;
      height: 40px;
      position: absolute;
      bottom: -20px;
    }
    .tire.left {
      left: 10px;
    }
    .tire.right {
      right: 10px;
    }
    .decor {
      width: 30px;
      height: 30px;
      position: absolute;
      top: 0;
      left: 85px;
    }
    .game-container {
      position: relative;
      width: 300px;
      height: 500px;
      margin: auto;
      background: #222;
      overflow: hidden;
      border-radius: 10px;
    }
    .enemy, .player {
      position: absolute;
      width: 50px;
      height: 80px;
      border-radius: 10px;
    }
    .player {
      background-color: blue;
      bottom: 10px;
    }
    .score-board {
      position: absolute;
      top: 10px;
      right: 10px;
      color: white;
      font-weight: bold;
      text-align: right;
      user-select: none;
    }
  </style>
</head>
<body>
  <div id="page1" class="page active">
    <h1>ê°€ìƒ ìë™ì°¨ ì„¤ê³„ & ë¯¸ë‹ˆ ê²Œì„ ì‹œë®¬ë ˆì´í„°</h1>
    <button onclick="goToPage('page2')">í”Œë ˆì´í•˜ê¸°</button>
  </div>

  <div id="page2" class="page">
    <h2>ğŸš— ìë™ì°¨ ì„¤ê³„í•˜ê¸°</h2>
    <div class="car-preview" id="carPreview">
      <img id="modelImage" src="images/model1.png" alt="ëª¨í˜•" style="width: 100%; height: 100%; position: absolute; top: 0; left: 0;" onerror="this.src='images/default-model.png'">
      <img class="tire left" id="tireLeft" src="images/tire1.png" alt="íƒ€ì´ì–´ ì™¼ìª½" onerror="this.src='images/default-tire.png'">
      <img class="tire right" id="tireRight" src="images/tire1.png" alt="íƒ€ì´ì–´ ì˜¤ë¥¸ìª½" onerror="this.src='images/default-tire.png'">
      <img class="decor" id="decorImage" src="" style="display: none;" onerror="this.src='images/default-decor.png'">
    </div>
    <button onclick="showOption('tires')">íƒ€ì´ì–´</button>
    <button onclick="showOption('model')">ëª¨í˜•</button>
    <button onclick="showOption('decor')">ì¥ì‹ ë¶€í’ˆ</button>
    <button onclick="goToPage('page3')">ê²Œì„ ì‹œì‘í•˜ê¸°</button>
  </div>

  <div id="optionMenu" class="page">
    <h2 id="optionTitle"></h2>
    <div id="optionContent"></div>
    <button onclick="goBackToDesign()">ë’¤ë¡œê°€ê¸°</button>
  </div>

  <div id="page3" class="page">
    <h2>ğŸ® ê²Œì„ ì¤‘</h2>
    <div class="game-container" id="gameArea">
      <div class="score-board">
        <div>ì‹œê°„: <span id="timer">0</span>s</div>
        <div>ì ìˆ˜: <span id="score">0</span></div>
      </div>
      <img class="player" id="playerCar" src="" style="left: 125px;" onerror="this.src='images/default-model.png'">
    </div>
  </div>

  <div id="page4" class="page">
    <h2>ê²Œì„ ì¢…ë£Œ!</h2>
    <p>ìµœì¢… ì ìˆ˜: <span id="finalScore"></span></p>
    <button onclick="goToPage('page2')">ìë™ì°¨ ì„¤ê³„ë¡œ ëŒì•„ê°€ê¸°</button>
    <button onclick="goToPage('page3', true)">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
  </div>

  <script>
    let currentPage = 'page1';

    // ê¸°ë³¸ ì´ë¯¸ì§€ ê²½ë¡œ ì„¤ì • (images í´ë” ì•ˆì— ì‹¤ì œ ì´ë¯¸ì§€ê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤)
    let carConfig = {
      tires: 'images/tire1.png',
      model: 'images/model1.png',
      decor: null
    };

    let timer = 0, score = 0, interval, gameRunning = false;

    function goToPage(pageId, resetGame = false) {
      document.getElementById(currentPage).classList.remove('active');
      document.getElementById(pageId).classList.add('active');
      currentPage = pageId;

      if (pageId === 'page3') {
        setupGame();
        if (resetGame) startGame();
      }
    }

    function showOption(type) {
      document.getElementById(currentPage).classList.remove('active');
      document.getElementById('optionMenu').classList.add('active');
      currentPage = 'optionMenu';

      const titleMap = {
        tires: 'íƒ€ì´ì–´ ì„ íƒ',
        model: 'ëª¨í˜• ì„ íƒ',
        decor: 'ì¥ì‹ ë¶€í’ˆ ì„ íƒ'
      };
      document.getElementById('optionTitle').innerText = titleMap[type];

      // ì˜µì…˜ íŒŒì¼ëª…ë§Œ, images í´ë” ë‚´ ì´ë¯¸ì§€ë¡œ ê°„ì£¼
      const options = {
        tires: ['tire1.png', 'tire2.png', 'tire3.png'],
        model: ['model1.png', 'model2.png', 'model3.png'],
        decor: ['decor1.png', 'decor2.png', '']  // ''ëŠ” ì¥ì‹ ì—†ìŒ
      };

      const content = document.getElementById('optionContent');
      content.innerHTML = '';
      options[type].forEach(option => {
        const btn = document.createElement('button');
        btn.innerText = option || 'ì¥ì‹ ì—†ìŒ';
        btn.onclick = () => {
          const fullPath = option ? `images/${option}` : null;

          if (type === 'tires') {
            carConfig.tires = fullPath;
            document.getElementById('tireLeft').src = fullPath || 'images/default-tire.png';
            document.getElementById('tireRight').src = fullPath || 'images/default-tire.png';
          } else if (type === 'model') {
            carConfig.model = fullPath;
            document.getElementById('modelImage').src = fullPath || 'images/default-model.png';
          } else if (type === 'decor') {
            carConfig.decor = fullPath;
            const decorImg = document.getElementById('decorImage');
            if (fullPath) {
              decorImg.src = fullPath;
              decorImg.style.display = 'block';
            } else {
              decorImg.style.display = 'none';
            }
          }
        };
        content.appendChild(btn);
      });
    }

    function goBackToDesign() {
      document.getElementById('optionMenu').classList.remove('active');
      document.getElementById('page2').classList.add('active');
      currentPage = 'page2';
    }

    function setupGame() {
      const playerCar = document.getElementById('playerCar');
      playerCar.src = carConfig.model || 'images/default-model.png';
      playerCar.style.left = '125px';

      // ê²Œì„ ì˜ì—­ ì´ˆê¸°í™” (ì  ì°¨, ì ìˆ˜íŒ ìœ ì§€)
      const gameArea = document.getElementById('gameArea');
      // ê²Œì„ ì‹œì‘ ì „ ì  ì‚­ì œ
      [...gameArea.querySelectorAll('.enemy')].forEach(enemy => enemy.remove());
    }

    function startGame() {
      timer = 0;
      score = 0;
      gameRunning = true;
      const player = document.getElementById('playerCar');
      let x = 125;

      document.getElementById('timer').innerText = timer;
      document.getElementById('score').innerText = score;

      const gameArea = document.getElementById('gameArea');
      const enemies = [];

      document.onkeydown = e => {
        if (!gameRunning) return;
        if (e.key === 'ArrowLeft') x -= 10;
        if (e.key === 'ArrowRight') x += 10;
        x = Math.max(0, Math.min(250, x));
        player.style.left = x + 'px';
      };

      if (interval) clearInterval(interval);
      interval = setInterval(() => {
        if (!gameRunning) return;

        // íƒ€ì´ë¨¸ ë° ì ìˆ˜ ì¦ê°€
        timer++;
        score++;
        document.getElementById('timer').innerText = timer;
        document.getElementById('score').innerText = score;

        // ì  ì°¨ëŸ‰ ìƒì„± (ìµœëŒ€ 5ê°œê¹Œì§€ ìœ ì§€)
        if (enemies.length < 5) {
          const enemy = document.createElement('div');
          enemy.classList.add('enemy');
          enemy.style.backgroundColor = 'red';
          enemy.style.left = Math.floor(Math.random() * 250) + 'px';
          enemy.style.top = '0px';
          gameArea.appendChild(enemy);
          enemies.push(enemy);
        }

        // ì  ì°¨ëŸ‰ ì´ë™ ë° ì¶©ëŒ ì²´í¬ (ë’¤ì—ì„œ ì•ìœ¼ë¡œ ìˆœíšŒ)
        for (let i = enemies.length - 1; i >= 0; i--) {
          const en = enemies[i];
          let top = parseInt(en.style.top);
          top += 5;
          en.style.top = top + 'px';

          if (top > 420) {
            en.remove();
            enemies.splice(i, 1);
            continue;
          }

          const playerTop = 410;
          const playerLeft = parseInt(player.style.left);
          const enemyLeft = parseInt(en.style.left);

          // ì¶©ëŒ íŒì • (ê°„ë‹¨í•œ ì‚¬ê°í˜• ì¶©ëŒ)
          if (top >= playerTop && Math.abs(playerLeft - enemyLeft) < 50) {
            gameOver();
          }
        }
      }, 100);
    }

    function gameOver() {
      gameRunning = false;
      clearInterval(interval);
      document.getElementById('finalScore').innerText = score;
      goToPage('page4');
    }
  </script>
</body>
</html>
